webpackJsonp([0],[,function(t,e,n){"use strict";e.a={apiURL:"http://192.168.79.102:8080",xhrConfig:{mode:"cors"},handleFetchErrors:function(t){if(!t.ok)throw Error(t.statusText);return t},alertError:function(t){alert(t)}}},,function(t,e,n){"use strict";var i=n(2),a=n(30),r=n(18),s=n.n(r),o=n(20),c=n.n(o),d=n(22),l=n.n(d);i.a.use(a.a),e.a=new a.a({mode:"history",routes:[{path:"/",name:"home",component:s.a},{path:"/simulation",name:"simulation",component:c.a},{path:"/trades",name:"trades",component:l.a}]})},function(t,e,n){function i(t){n(14)}var a=n(0)(n(6),n(24),i,null,null);t.exports=a.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),a=n(4),r=n.n(a),s=n(3);new i.a({el:"#app",router:s.a,render:function(t){return t(r.a)}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.default={name:"childrenselection",props:["show","childrenof","activenodes","simulationday","simulationid"],data:function(){return{loading:!0,children:[],selectedChildren:[]}},computed:{activeNodeArray:function(){return this.activenodes.split(",")}},watch:{show:function(){var t=this;this.show&&(this.loading=!0,fetch(i.a.apiURL+"/children?sim="+this.simulationid+"&day="+this.simulationday+"&selection="+this.childrenof,i.a.xhrConfig).then(i.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.children=[],e.children.forEach(function(e){return t.children.push(e.label)}),t.activeChildren=t.children.filter(function(e){return t.activeNodeArray.includes(e)}),t.loading=!1}).catch(function(t){return i.a.alertError(t)}))}},methods:{saveSelection:function(){var t=this,e=this.activeNodeArray.filter(function(e){return!t.children.includes(e)});e=e.concat(this.activeChildren),this.$emit("setactivenodes",e.join()),this.$emit("update:show",!1)},cancelSelection:function(){this.$emit("update:show",!1)}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.default={name:"home",data:function(){return{loading:!0,simulations:null}},created:function(){var t=this;fetch(i.a.apiURL+"/list",i.a.xhrConfig).then(i.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.simulations=e.sims,t.loading=!1}).catch(function(t){return i.a.alertError(t)})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.default={name:"nodeinfo",props:["show","agent","simulationday","simulationid"],data:function(){return{loading:!0,info:{}}},watch:{show:function(){var t=this;this.show&&(this.loading=!0,fetch(i.a.apiURL+"/agents?sim="+this.simulationid+"&day="+this.simulationday+"&selection="+this.agent,i.a.xhrConfig).then(i.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.info=e,t.loading=!1}).catch(function(t){return i.a.alertError(t)}))}},methods:{closeInfo:function(){this.$emit("update:show",!1)}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.default={name:"simulationview",data:function(){return{loading:!0,loadingRanking:!0,simDescription:"",ranking:null}},created:function(){var t=this;fetch(i.a.apiURL+"/info?sim="+this.$route.query.sim,i.a.xhrConfig).then(i.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.simDescription=e.name,t.loading=!1}).catch(function(t){return i.a.alertError(t)}),fetch(i.a.apiURL+"/ranking?sim="+this.$route.query.sim,i.a.xhrConfig).then(i.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.ranking=e.list,t.loadingRanking=!1}).catch(function(t){return i.a.alertError(t)})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(13);n.n(i);e.default={name:"tradegraph",props:["graphdata","selectednode"],data:function(){return{graph:{stage:null,firmNodes:null,firmsTree:null,firmsTreeOffset:[1e3,100],firmsTreeDirection:1,consumersNodes:null,consumersTree:null,consumersTreeOffset:[700,100],consumersTreeDirection:-1,nodeCoordinates:{},NODE_RADIUS:50,NODE_RADIUS_BASE:2,INTER_LAYER_GAP:50,INTRA_LAYER_GAP:10,HORIZONTAL_GAP:50}}},mounted:function(){this.graph.stage=i.select("#stage"),this.updateTradegraph()},watch:{graphdata:function(){this.updateTradegraph()}},methods:{updateTradegraph:function(){this.graph.firmNodes=this.stratifyData(this.graphdata.firms),this.graph.consumerNodes=this.stratifyData(this.graphdata.consumers),this.graph.nodeCoordinates={},this.calculateNodeCoordinates(this.graph.firmNodes),this.calculateNodeCoordinates(this.graph.consumerNodes),this.drawLinks(this.graphdata.edges),this.drawNodes(this.graph.firmNodes),this.drawNodes(this.graph.consumerNodes)},addClickToNodes:function(){var t=this;i.selectAll(".node").on("click",function(e){return t.$emit("nodeclicked",e.data.id)}),i.selectAll(".childrenselection").on("click",function(e){return t.$emit("showchildren",e.data.id)}),i.selectAll(".infoselection").on("click",function(e){return t.$emit("showinfo",e.data.id)})},stratifyData:function(t){var e=i.stratify().id(function(t){return t.label}).parentId(function(t){return t.parent})(t);return i.hierarchy(e,function(t){return t.children})},calculateNodeCoordinates:function(t){var e=this,n=0,i=0,a=void 0,r=void 0,s=-this.graph.INTRA_LAYER_GAP;"firms"===t.data.id?(a=this.graph.firmsTreeOffset,r=this.graph.firmsTreeDirection*this.graph.HORIZONTAL_GAP):"consumers"===t.data.id&&(a=this.graph.consumersTreeOffset,r=this.graph.consumersTreeDirection*this.graph.HORIZONTAL_GAP),t.descendants().forEach(function(t,o){t.depth===n&&0!==o?(i+=1,t.data.x=a[0]+i*r):(t.data.x=a[0],i=0,s+=15),t.data.y=e.graph.INTER_LAYER_GAP*o+s+a[1],n=t.depth,e.graph.nodeCoordinates[t.data.id]={x:t.data.x,y:t.data.y,size:t.data.data.size}})},drawNodes:function(t){var e=this,n=this,a="firms"===t.data.id?"firms":"consumers",r=this.graph.stage.selectAll(".node--"+t.data.id).data(t.descendants());r.exit().remove();var s=r.enter(),o=s.append("g").attr("id",function(t){return t.data.id}).attr("class",function(e){return"node node--"+t.data.id+" "+(e.children?"branch":"leaf")});o.append("path").attr("class","node__edge").attr("d",function(t,e){return e>0?"M 0 0 L"+(t.parent.data.x-t.data.x)+" "+(t.parent.data.y-t.data.y):""});var c=i.scaleOrdinal(i.schemeCategory10);o.append("circle").attr("class","node__circle").attr("cx",0).attr("cy",0).attr("fill",function(t,e){return c(e)}),o.append("text").attr("class","node__text").attr("text-anchor",function(){return"firms"===a?"start":"end"}),o.append("circle").attr("class","childrenselection").attr("r","4px").attr("cx","-20px").attr("cy","-10px"),o.append("circle").attr("class","infoselection").attr("r","4px").attr("cx","-20px").attr("cy","10px");var d=r.merge(o).classed("node--out",function(t){return e.selectednode&&t.data.id!==e.selectednode}).attr("transform",function(t){return"translate("+n.graph.nodeCoordinates[t.data.id].x+",\n            "+n.graph.nodeCoordinates[t.data.id].y+")"});d.select(".node__circle").transition().attr("r",function(t){return n.graph.NODE_RADIUS_BASE*t.data.data.size}),d.select(".node__text").transition().attr("dx",function(t){var e=-.5,i=-.5;return"firms"===a&&(e=.5,i=.5),n.graph.NODE_RADIUS_BASE*t.data.data.size*e+i}).attr("dy",function(t){return n.graph.NODE_RADIUS_BASE*t.data.data.size*-1-5}).text(function(t){return t.data.id}),this.addClickToNodes()},drawLinks:function(t){var e=this;if(i.selectAll(".links__wrapper").remove(),i.selectAll("defs").remove(),t.length>0){var n=t[0].source,a=t[0].destination,r=0,s=0,o=0,c=0,d=0,l=0,h=0,u=0,f=this.graph.stage.append("g").attr("class","links__wrapper"),p=f.selectAll(".link").data(t);p.exit().remove();var m=p.enter();p.merge(m).each(function(t,i){if(t.source===n&&t.destination===a&&0!==i)u+=1;else{u=0,0!==i&&(f=e.graph.stage.append("g").attr("class","links__wrapper")),r=e.graph.nodeCoordinates[t.source].x,s=e.graph.nodeCoordinates[t.source].y,o=e.graph.nodeCoordinates[t.destination].x,c=e.graph.nodeCoordinates[t.destination].y,d=o-r,l=c-s;var p=0;h=Math.atan(l/d)*(180/Math.PI),d<0&&(p=-180),h+=p,f.attr("transform","translate("+r+", "+s+") rotate("+h+")"),n=t.source,a=t.destination}var m=e.graph.NODE_RADIUS_BASE*e.graph.nodeCoordinates[t.source].size||e.graph.NODE_RADIUS,v=e.graph.NODE_RADIUS_BASE*e.graph.nodeCoordinates[t.destination].size||e.graph.NODE_RADIUS,_=u+2,g=d/Math.cos(h*Math.PI/180),y=0+m*Math.cos(.3*(u+1)),w=0-m*Math.sin(.3*(u+1)),x=g;x-=(v+8)*Math.cos(.3*(u+1));var D=-(v+8)*Math.sin(.3*(u+1)),N=_*y,A=_*(x-g)+g,C=_*w,k=_*D;f.append("path").attr("class","link").attr("d","M "+y+" "+w+" C "+N+" "+C+", "+A+" "+k+", "+x+" "+D).attr("stroke-width",t.weight+"px").attr("marker-end",function(){return"url(#marker)"})}),this.graph.stage.append("defs").append("marker").attr("id","marker").attr("class","marker").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("path").attr("d","M0,-5L10,0L0,5")}}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(21),a=n.n(i),r=n(17),s=n.n(r),o=n(19),c=n.n(o),d=n(1);e.default={name:"tradeview",components:{Tradegraph:a.a,Childselection:s.a,Nodeinfo:c.a},data:function(){return{apiUrl:d.a.apiURL,tradeGraphData:null,loaded:!1,playing:!1,playInterval:null,metrics:["ALL"],selectedNode:this.$route.query.selected,showNodeInfo:!1,infoOf:null,showChildSelection:!1,childrenOf:null,selectedMetric:"",simId:this.$route.query.sim,simDay:parseInt(this.$route.query.day,10),simAgents:this.$route.query.agents,simStep:parseInt(this.$route.query.step,10),simLength:null}},created:function(){var t=this;this.fetchData(),fetch(this.apiUrl+"/info?sim="+this.simId,d.a.xhrConfig).then(d.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.simLength=e.days}).catch(function(t){return d.a.alertError(t)}),fetch(this.apiUrl+"/metrics",d.a.xhrConfig).then(d.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){e.metrics.forEach(function(e){t.metrics.push(e)})}).catch(function(t){return d.a.alertError(t)})},watch:{$route:"fetchData",playing:function(){this.playing?this.playInterval=setInterval(this.nextStep,100):clearInterval(this.playInterval)},simDay:function(){this.goToNewDay()},simAgents:function(){this.goToNewDay()}},methods:{nextStep:function(){this.simDay=Math.min(this.simDay+this.simStep,this.simLength),this.simDay===this.simLength&&(this.playing=!1)},prevStep:function(){this.simDay=Math.max(this.simDay-this.simStep,0)},goToNewDay:function(){this.$router.replace({name:"trades",query:{sim:this.simId,day:this.simDay,agents:this.simAgents,step:this.simStep,selected:this.selectedNode}})},fetchData:function(){var t=this;fetch(this.apiUrl+"/tradegraph?sim="+this.simId+"&day="+this.simDay+"&agents="+this.simAgents+"&step="+this.simStep,d.a.xhrConfig).then(d.a.handleFetchErrors).then(function(t){return t.json()}).then(function(e){t.tradeGraphData=e,t.loaded=!0}).catch(function(t){return d.a.alertError(t)})},handleNodeClicked:function(t){this.selectedNode&&this.selectedNode===t?this.selectedNode=null:this.selectedNode=t,this.goToNewDay()},handleShowInfo:function(t){this.infoOf=t,this.showNodeInfo=!0},handleShowChildren:function(t){this.childrenOf=t,this.showChildSelection=!0},handleSetActiveNodes:function(t){this.simAgents=t}}}},,function(t,e){},function(t,e){},function(t,e){},function(t,e,n){var i=n(0)(n(7),n(25),null,null,null);t.exports=i.exports},function(t,e,n){var i=n(0)(n(8),n(23),null,null,null);t.exports=i.exports},function(t,e,n){var i=n(0)(n(9),n(29),null,null,null);t.exports=i.exports},function(t,e,n){var i=n(0)(n(10),n(27),null,null,null);t.exports=i.exports},function(t,e,n){function i(t){n(15)}var a=n(0)(n(11),n(26),i,null,null);t.exports=a.exports},function(t,e,n){function i(t){n(16)}var a=n(0)(n(12),n(28),i,null,null);t.exports=a.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Simulations")]),t._v(" "),t.loading?n("div",[t._v("Loading...")]):t._e(),t._v(" "),t.loading?t._e():n("ul",t._l(t.simulations,function(e){return n("li",[n("router-link",{attrs:{to:{name:"simulation",query:{sim:e.path}}}},[t._v(t._s(e.owner+" / "+e.path))])],1)}))])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("ul",[n("li",[n("router-link",{attrs:{to:{name:"home"}}},[t._v("Simulations")])],1)]),t._v(" "),n("router-view")],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("div",[n("h2",[t._v("Childselection "+t._s(t.childrenof)+" on day "+t._s(t.simulationday))]),t._v(" "),t.loading?n("div",[t._v("Loading ...")]):t._e(),t._v(" "),t.loading?t._e():n("div",[n("ul",t._l(t.children,function(e){return n("li",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.activeChildren,expression:"activeChildren"}],attrs:{type:"checkbox",name:"selection"},domProps:{value:e,checked:Array.isArray(t.activeChildren)?t._i(t.activeChildren,e)>-1:t.activeChildren},on:{__c:function(n){var i=t.activeChildren,a=n.target,r=!!a.checked;if(Array.isArray(i)){var s=e,o=t._i(i,s);a.checked?o<0&&(t.activeChildren=i.concat(s)):o>-1&&(t.activeChildren=i.slice(0,o).concat(i.slice(o+1)))}else t.activeChildren=r}}}),t._v(" "+t._s(e)+"\n      ")])})),t._v(" "),n("div",[t._v(t._s(t.activeNodeArray))])]),t._v(" "),t.loading?t._e():n("button",{on:{click:t.saveSelection}},[t._v("Save")]),t._v(" "),n("button",{on:{click:t.cancelSelection}},[t._v("Cancel")])]):t._e()},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("svg",{staticClass:"tradegraph",attrs:{id:"stage",xmlns:"http://www.w3.org/2000/svg"}})])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Simulation '"+t._s(this.$route.query.sim)+"'")]),t._v(" "),t.loading?n("div",[t._v("Loading...")]):t._e(),t._v(" "),t.loading?t._e():n("ul",[n("li",[n("a",{attrs:{href:t.simDescription,target:"_blank"}},[t._v("Description")])]),t._v(" "),n("li",[n("router-link",{attrs:{to:{name:"trades",query:{sim:this.$route.query.sim,day:0,agents:"consumers,firms",step:1}}}},[t._v("Tradeview")])],1)]),t._v(" "),t.loadingRanking?t._e():n("ol",t._l(t.ranking,function(e){return n("li",[t._v("\n      "+t._s(e.type+": "+e.averageUtility)+"\n    ")])}))])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Tradeview")]),t._v(" "),t.loaded?n("div",[t.simDay>0?n("button",{on:{click:t.prevStep}},[t._v("<")]):t._e(),t._v(" "),t.simDay<t.simLength?n("button",{on:{click:t.nextStep}},[t._v(">")]):t._e(),t._v(" "),t.simDay<t.simLength?n("button",{on:{click:function(e){t.playing=!t.playing}}},[t._v(t._s(t.playing?"||":"|>"))]):t._e(),t._v(" "),t.simDay>0?n("button",{on:{click:function(e){t.simDay=0}}},[t._v("<<")]):t._e(),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.simDay,expression:"simDay",modifiers:{number:!0}}],domProps:{value:t.simDay},on:{input:function(e){e.target.composing||(t.simDay=t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedMetric,expression:"selectedMetric"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selectedMetric=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"",disabled:""}},[t._v("Please select")]),t._v(" "),t._l(t.metrics,function(e){return[n("option",[t._v(t._s(e))])]})],2),t._v(" "),t.selectedMetric?n("a",{attrs:{href:t.apiUrl+"/getMetric?metric="+this.selectedMetric+"&sim="+this.simId+"&day="+this.simDay+"&agents="+this.simAgents+"&step="+this.simStep,target:"_blank"}},[t._v("Download")]):t._e(),t._v(" "),n("tradegraph",{attrs:{graphdata:t.tradeGraphData,selectednode:t.selectedNode},on:{nodeclicked:t.handleNodeClicked,showinfo:t.handleShowInfo,showchildren:t.handleShowChildren}}),t._v(" "),n("childselection",{attrs:{show:t.showChildSelection,childrenof:t.childrenOf,activenodes:t.simAgents,simulationday:t.simDay,simulationid:t.simId},on:{"update:show":function(e){t.showChildSelection=e},setactivenodes:t.handleSetActiveNodes}}),t._v(" "),n("nodeinfo",{attrs:{show:t.showNodeInfo,agent:t.infoOf,simulationday:t.simDay,simulationid:t.simId},on:{"update:show":function(e){t.showNodeInfo=e}}})],1):t._e()])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("div",[n("h2",[t._v("Info of "+t._s(t.agent)+" on day "+t._s(t.simulationday))]),t._v(" "),t.loading?n("div",[t._v("Loading ...")]):t._e(),t._v(" "),t.loading?t._e():n("div",[n("ul",t._l(t.info,function(e,i){return n("li",[t._v(t._s(i)+": "+t._s(e))])}))]),t._v(" "),n("button",{on:{click:t.closeInfo}},[t._v("Close")])]):t._e()},staticRenderFns:[]}}],[5]);
//# sourceMappingURL=app.f36f97d29ffd3b37918e.js.map